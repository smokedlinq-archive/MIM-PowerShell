Ûº
7C:\w\MIM-PowerShell\src\MIM.PowerShell\PSTraceSource.cs
	namespace 	
MIM
 
. 

PowerShell 
{ 
public 

class 
PSTraceSource 
:  
TraceSource! ,
{ 
public 
PSTraceSource 
( 
string #
name$ (
)( )
: 
base 
( 
name 
) 
{ 	
try 
{ 
var 
key 
= 
Registry "
." #
LocalMachine# /
./ 0

OpenSubKey0 :
(: ;
$str	; ó
)
ó ò
;
ò ô
var 
path 
= 
( 
string "
)" #
key# &
.& '
GetValue' /
(/ 0
$str0 6
,6 7
string8 >
.> ?
Empty? D
)D E
;E F
this 
. 
Switch 
. 
Level !
=" #
SourceLevels$ 0
.0 1
Information1 <
;< =
if 
( 
! 
string 
. 
IsNullOrWhiteSpace .
(. /
path/ 3
)3 4
)4 5
{ 
if 
( 
! 
	Directory "
." #
Exists# )
() *
path* .
). /
)/ 0
	Directory   !
.  ! "
CreateDirectory  " 1
(  1 2
path  2 6
)  6 7
;  7 8
var"" 
value"" 
="" 
(""  !
string""! '
)""' (
key""( +
.""+ ,
GetValue"", 4
(""4 5
$str""5 <
,""< =
string""> D
.""D E
Empty""E J
)""J K
;""K L
var## 
sourceLevel## #
=##$ %
SourceLevels##& 2
.##2 3
Off##3 6
;##6 7
if%% 
(%% 
!%% 
Enum%% 
.%% 
TryParse%% &
<%%& '
SourceLevels%%' 3
>%%3 4
(%%4 5
value%%5 :
,%%: ;
out%%< ?
sourceLevel%%@ K
)%%K L
)%%L M
sourceLevel&& #
=&&$ %
SourceLevels&&& 2
.&&2 3
All&&3 6
;&&6 7
this(( 
.(( 
Switch(( 
.((  
Level((  %
=((& '
sourceLevel((( 3
;((3 4
this** 
.** 
	Listeners** "
.**" #
Add**# &
(**& '
new**' *"
XmlWriterTraceListener**+ A
(**A B
Path**B F
.**F G
Combine**G N
(**N O
path**O S
,**S T
$str**U l
)**l m
,**m n
$str	**o î
)
**î ï
)
**ï ñ
;
**ñ ó
}++ 
this-- 
.-- 
	Listeners-- 
.-- 
Add-- "
(--" #
new--# &!
EventLogTraceListener--' <
(--< =
$str--= M
)--M N
{.. 
Filter// 
=// 
new//  
EventTypeFilter//! 0
(//0 1
SourceLevels//1 =
.//= >
Information//> I
)//I J
}00 
)00 
;00 
}11 
catch22 
{33 
}55 
}66 	
public88 
IDisposable88 
TraceMethod88 &
(88& '
)88' (
{99 	
return:: 
TraceMethod:: 
(:: &
GetCallingMethodDefinition:: 9
(::9 :
)::: ;
)::; <
;::< =
};; 	
IDisposable== 
TraceMethod== 
(==  
string==  &
activityName==' 3
)==3 4
{>> 	
var?? 
activity?? 
=?? #
PowerShellTraceActivity?? 2
.??2 3
Start??3 8
(??8 9
this??9 =
,??= >
activityName??? K
)??K L
;??L M
tryAA 
{BB 
ifCC 
(CC 
!CC 
stringCC 
.CC 
IsNullOrWhiteSpaceCC .
(CC. /
MAUtilsCC/ 6
.CC6 7
MAFolderCC7 ?
)CC? @
)CC@ A
{DD 
varEE 
maNameEE 
=EE  
	DirectoryEE! *
.EE* +
	GetParentEE+ 4
(EE4 5
MAUtilsEE5 <
.EE< =
MAFolderEE= E
)EEE F
.EEF G
NameEEG K
;EEK L
thisFF 
.FF 
TraceVerboseFF %
(FF% &
$strFF& E
,FFE F
maNameFFG M
)FFM N
;FFN O
}GG 
}HH 
catchII 
(II %
InvalidOperationExceptionII ,
)II, -
{JJ 
}LL 
returnNN 
activityNN 
;NN 
}OO 	
[QQ 	
ConditionalQQ	 
(QQ 
$strQQ 
)QQ 
]QQ 
publicRR 
voidRR 
TraceParameterRR "
<RR" #
TRR# $
>RR$ %
(RR% &
stringRR& ,
parameterNameRR- :
,RR: ;
TRR< =
objRR> A
)RRA B
{SS 	
TraceObjectTT 
(TT 
TraceEventTypeTT &
.TT& '
VerboseTT' .
,TT. /
objTT0 3
,TT3 4
parameterNameTT5 B
)TTB C
;TTC D
}UU 	
[WW 	
ConditionalWW	 
(WW 
$strWW 
)WW 
]WW 
publicXX 
voidXX 
TraceObjectXX 
<XX  
TXX  !
>XX! "
(XX" #
TXX# $
objXX% (
)XX( )
{YY 	
ifZZ 
(ZZ 
objZZ 
==ZZ 
nullZZ 
)ZZ 
return[[ 
;[[ 
TraceObject]] 
(]] 
TraceEventType]] &
.]]& '
Verbose]]' .
,]]. /
obj]]0 3
,]]3 4
typeof]]5 ;
(]]; <
T]]< =
)]]= >
.]]> ?!
AssemblyQualifiedName]]? T
)]]T U
;]]U V
}^^ 	
[`` 	
Conditional``	 
(`` 
$str`` 
)`` 
]`` 
publicaa 
voidaa 
TraceObjectaa 
<aa  
Taa  !
>aa! "
(aa" #
TraceEventTypeaa# 1
	eventTypeaa2 ;
,aa; <
Taa= >
objaa? B
,aaB C
stringaaD J
nameaaK O
)aaO P
{bb 	
ifcc 
(cc 
objcc 
==cc 
nullcc 
||cc 
!cc  
thiscc  $
.cc$ %
Switchcc% +
.cc+ ,
ShouldTracecc, 7
(cc7 8
	eventTypecc8 A
)ccA B
)ccB C
returndd 
;dd 
ifff 
(ff 
objff 
isff 
	ValueTypeff  
)ff  !
{gg 
thishh 
.hh 

TraceEventhh 
(hh  
	eventTypehh  )
,hh) *
$numhh+ ,
,hh, -
objhh. 1
.hh1 2
ToStringhh2 :
(hh: ;
)hh; <
)hh< =
;hh= >
}ii 
elsejj 
ifjj 
(jj 
objjj 
isjj 
Delegatejj $
)jj$ %
{kk 
thisll 
.ll 

TraceEventll 
(ll  
	eventTypell  )
,ll) *
$numll+ ,
,ll, -
$strll. :
+ll; <
objll= @
.ll@ A
ToStringllA I
(llI J
)llJ K
)llK L
;llL M
}mm 
elsenn 
{oo 
trypp 
{qq 
varrr 

serializerrr "
=rr# $
newrr% ( 
JavaScriptSerializerrr) =
(rr= >
)rr> ?
;rr? @
varss 
jsonss 
=ss 

serializerss )
.ss) *
	Serializess* 3
(ss3 4
objss4 7
)ss7 8
;ss8 9
ifuu 
(uu 
stringuu 
.uu 
IsNullOrWhiteSpaceuu 1
(uu1 2
nameuu2 6
)uu6 7
)uu7 8
thisvv 
.vv 

TraceEventvv '
(vv' (
	eventTypevv( 1
,vv1 2
$numvv3 4
,vv4 5
namevv6 :
+vv; <
$strvv= A
+vvB C
jsonvvD H
)vvH I
;vvI J
}ww 
catchxx 
(xx 
	Exceptionxx  
exxx! #
)xx# $
{yy 
this{{ 
.{{ 
	TraceData{{ "
({{" #
	eventType{{# ,
,{{, -
$num{{. /
,{{/ 0
obj{{1 4
){{4 5
;{{5 6
this|| 
.|| 
TraceException|| '
(||' (
TraceEventType||( 6
.||6 7
Error||7 <
,||< =
ex||> @
,||@ A
$str||B [
,||[ \
name||] a
)||a b
;||b c
}}} 
}~~ 
} 	
[
ÅÅ 	
Conditional
ÅÅ	 
(
ÅÅ 
$str
ÅÅ 
)
ÅÅ 
]
ÅÅ 
public
ÇÇ 
void
ÇÇ 
TraceVerbose
ÇÇ  
(
ÇÇ  !
string
ÇÇ! '
message
ÇÇ( /
)
ÇÇ/ 0
{
ÉÉ 	
this
ÑÑ 
.
ÑÑ 

TraceEvent
ÑÑ 
(
ÑÑ 
TraceEventType
ÑÑ *
.
ÑÑ* +
Verbose
ÑÑ+ 2
,
ÑÑ2 3
$num
ÑÑ4 5
,
ÑÑ5 6
message
ÑÑ7 >
)
ÑÑ> ?
;
ÑÑ? @
}
ÖÖ 	
[
áá 	
Conditional
áá	 
(
áá 
$str
áá 
)
áá 
]
áá 
public
àà 
void
àà 
TraceVerbose
àà  
(
àà  !
string
àà! '
format
àà( .
,
àà. /
params
àà0 6
object
àà7 =
[
àà= >
]
àà> ?
args
àà@ D
)
ààD E
{
ââ 	
this
ää 
.
ää 

TraceEvent
ää 
(
ää 
TraceEventType
ää *
.
ää* +
Verbose
ää+ 2
,
ää2 3
$num
ää4 5
,
ää5 6
format
ää7 =
,
ää= >
args
ää? C
)
ääC D
;
ääD E
}
ãã 	
[
çç 	
Conditional
çç	 
(
çç 
$str
çç 
)
çç 
]
çç 
public
éé 
void
éé 
TraceException
éé "
(
éé" #
TraceEventType
éé# 1
	eventType
éé2 ;
,
éé; <
	Exception
éé= F
ex
ééG I
,
ééI J
string
ééK Q
format
ééR X
,
ééX Y
params
ééZ `
object
ééa g
[
éég h
]
ééh i
args
ééj n
)
één o
{
èè 	
this
êê 
.
êê 

TraceEvent
êê 
(
êê 
	eventType
êê %
,
êê% &
$num
êê' (
,
êê( )
format
êê* 0
,
êê0 1
args
êê2 6
)
êê6 7
;
êê7 8
this
ëë 
.
ëë 
	TraceData
ëë 
(
ëë 
	eventType
ëë $
,
ëë$ %
$num
ëë& '
,
ëë' (
ex
ëë) +
)
ëë+ ,
;
ëë, -
}
íí 	
[
îî 	

MethodImpl
îî	 
(
îî 
MethodImplOptions
îî %
.
îî% &

NoInlining
îî& 0
)
îî0 1
]
îî1 2
static
ïï 
string
ïï (
GetCallingMethodDefinition
ïï 0
(
ïï0 1
int
ïï1 4

skipFrames
ïï5 ?
=
ïï@ A
$num
ïïB C
)
ïïC D
{
ññ 	
var
óó 
sb
óó 
=
óó 
new
óó 
StringBuilder
óó &
(
óó& '
)
óó' (
;
óó( )
try
ôô 
{
öö 
var
õõ 
frame
õõ 
=
õõ 
new
õõ 

StackFrame
õõ  *
(
õõ* +

skipFrames
õõ+ 5
,
õõ5 6
true
õõ7 ;
)
õõ; <
;
õõ< =
var
úú 
method
úú 
=
úú 
frame
úú "
.
úú" #
	GetMethod
úú# ,
(
úú, -
)
úú- .
;
úú. /
var
ùù 
declaringType
ùù !
=
ùù" #
method
ùù$ *
.
ùù* +
DeclaringType
ùù+ 8
;
ùù8 9
var
ûû 

parameters
ûû 
=
ûû  
method
ûû! '
.
ûû' (
GetParameters
ûû( 5
(
ûû5 6
)
ûû6 7
;
ûû7 8
sb
°° 
.
°° 
AppendFormat
°° 
(
°°  
Thread
°°  &
.
°°& '
CurrentThread
°°' 4
.
°°4 5
CurrentCulture
°°5 C
,
°°C D
$str
°°E K
,
°°K L
method
°°M S
.
°°S T
DeclaringType
°°T a
.
°°a b
FullName
°°b j
)
°°j k
;
°°k l
if
££ 
(
££ 
declaringType
££ !
.
££! "
IsGenericType
££" /
)
££/ 0
{
§§ 
sb
•• 
.
•• 
Append
•• 
(
•• 
$str
•• !
)
••! "
;
••" #
sb
¶¶ 
.
¶¶ 
Append
¶¶ 
(
¶¶ 
string
¶¶ $
.
¶¶$ %
Join
¶¶% )
(
¶¶) *
$str
¶¶* .
,
¶¶. /
declaringType
¶¶0 =
.
¶¶= >!
GetGenericArguments
¶¶> Q
(
¶¶Q R
)
¶¶R S
.
¶¶S T
Select
¶¶T Z
(
¶¶Z [
i
¶¶[ \
=>
¶¶] _
string
¶¶` f
.
¶¶f g
Format
¶¶g m
(
¶¶m n
Thread
¶¶n t
.
¶¶t u
CurrentThread¶¶u Ç
.¶¶Ç É
CurrentCulture¶¶É ë
,¶¶ë í
$str¶¶ì ö
,¶¶ö õ
i¶¶ú ù
.¶¶ù û
FullName¶¶û ¶
)¶¶¶ ß
)¶¶ß ®
.¶¶® ©
ToArray¶¶© ∞
(¶¶∞ ±
)¶¶± ≤
)¶¶≤ ≥
)¶¶≥ ¥
;¶¶¥ µ
sb
ßß 
.
ßß 
Append
ßß 
(
ßß 
$str
ßß !
)
ßß! "
;
ßß" #
}
®® 
sb
™™ 
.
™™ 
AppendFormat
™™ 
(
™™  
Thread
™™  &
.
™™& '
CurrentThread
™™' 4
.
™™4 5
CurrentCulture
™™5 C
,
™™C D
$str
™™E M
,
™™M N
method
™™O U
.
™™U V
Name
™™V Z
)
™™Z [
;
™™[ \
if
¨¨ 
(
¨¨ 
method
¨¨ 
.
¨¨ 
IsGenericMethod
¨¨ *
)
¨¨* +
{
≠≠ 
sb
ÆÆ 
.
ÆÆ 
Append
ÆÆ 
(
ÆÆ 
$str
ÆÆ !
)
ÆÆ! "
;
ÆÆ" #
sb
ØØ 
.
ØØ 
Append
ØØ 
(
ØØ 
string
ØØ $
.
ØØ$ %
Join
ØØ% )
(
ØØ) *
$str
ØØ* .
,
ØØ. /
method
ØØ0 6
.
ØØ6 7!
GetGenericArguments
ØØ7 J
(
ØØJ K
)
ØØK L
.
ØØL M
Select
ØØM S
(
ØØS T
i
ØØT U
=>
ØØV X
string
ØØY _
.
ØØ_ `
Format
ØØ` f
(
ØØf g
Thread
ØØg m
.
ØØm n
CurrentThread
ØØn {
.
ØØ{ |
CurrentCultureØØ| ä
,ØØä ã
$strØØå ì
,ØØì î
iØØï ñ
.ØØñ ó
FullNameØØó ü
)ØØü †
)ØØ† °
.ØØ° ¢
ToArrayØØ¢ ©
(ØØ© ™
)ØØ™ ´
)ØØ´ ¨
)ØØ¨ ≠
;ØØ≠ Æ
sb
∞∞ 
.
∞∞ 
Append
∞∞ 
(
∞∞ 
$str
∞∞ !
)
∞∞! "
;
∞∞" #
}
±± 
sb
≥≥ 
.
≥≥ 
Append
≥≥ 
(
≥≥ 
$str
≥≥ 
)
≥≥ 
;
≥≥ 
if
µµ 
(
µµ 

parameters
µµ 
!=
µµ !
null
µµ" &
&&
µµ' )

parameters
µµ* 4
.
µµ4 5
Length
µµ5 ;
>
µµ< =
$num
µµ> ?
)
µµ? @
sb
∂∂ 
.
∂∂ 
Append
∂∂ 
(
∂∂ 
string
∂∂ $
.
∂∂$ %
Join
∂∂% )
(
∂∂) *
$str
∂∂* .
,
∂∂. /

parameters
∂∂0 :
.
∂∂: ;
Select
∂∂; A
(
∂∂A B
i
∂∂B C
=>
∂∂D F
string
∂∂G M
.
∂∂M N
Format
∂∂N T
(
∂∂T U
Thread
∂∂U [
.
∂∂[ \
CurrentThread
∂∂\ i
.
∂∂i j
CurrentCulture
∂∂j x
,
∂∂x y
$str∂∂z Ö
,∂∂Ö Ü
i∂∂á à
.∂∂à â
ParameterType∂∂â ñ
.∂∂ñ ó
FullName∂∂ó ü
,∂∂ü †
i∂∂° ¢
.∂∂¢ £
Name∂∂£ ß
)∂∂ß ®
)∂∂® ©
.∂∂© ™
ToArray∂∂™ ±
(∂∂± ≤
)∂∂≤ ≥
)∂∂≥ ¥
)∂∂¥ µ
;∂∂µ ∂
sb
∏∏ 
.
∏∏ 
Append
∏∏ 
(
∏∏ 
$str
∏∏ 
)
∏∏ 
;
∏∏ 
}
ππ 
catch
∫∫ 
{
ªª 
}
ºº 
return
ææ 
sb
ææ 
.
ææ 
ToString
ææ 
(
ææ 
)
ææ  
;
ææ  !
}
øø 	
class
¡¡ %
PowerShellTraceActivity
¡¡ %
:
¡¡& '
IDisposable
¡¡( 3
{
¬¬ 	
private
√√ 
Guid
√√ !
_previousActivityId
√√ ,
;
√√, -
private
ƒƒ 
Guid
ƒƒ 
_activityId
ƒƒ $
;
ƒƒ$ %
private
≈≈ 
TraceSource
≈≈ 
_source
≈≈  '
;
≈≈' (
private
∆∆ 
	Stopwatch
∆∆ 
_sw
∆∆ !
;
∆∆! "
private
«« 
string
«« 
_name
««  
;
««  !
private
…… %
PowerShellTraceActivity
…… +
(
……+ ,
TraceSource
……, 7
source
……8 >
,
……> ?
string
……@ F
name
……G K
)
……K L
{
   
this
ÀÀ 
.
ÀÀ 
_source
ÀÀ 
=
ÀÀ 
source
ÀÀ %
;
ÀÀ% &
this
ÃÃ 
.
ÃÃ 
_name
ÃÃ 
=
ÃÃ 
name
ÃÃ !
;
ÃÃ! "
this
ŒŒ 
.
ŒŒ !
_previousActivityId
ŒŒ (
=
ŒŒ) *
Trace
ŒŒ+ 0
.
ŒŒ0 1 
CorrelationManager
ŒŒ1 C
.
ŒŒC D

ActivityId
ŒŒD N
;
ŒŒN O
this
œœ 
.
œœ 
_activityId
œœ  
=
œœ! "
Guid
œœ# '
.
œœ' (
NewGuid
œœ( /
(
œœ/ 0
)
œœ0 1
;
œœ1 2
this
—— 
.
—— 
_sw
—— 
=
—— 
	Stopwatch
—— $
.
——$ %
StartNew
——% -
(
——- .
)
——. /
;
——/ 0
}
““ 
public
‘‘ 
static
‘‘ %
PowerShellTraceActivity
‘‘ 1
Start
‘‘2 7
(
‘‘7 8
TraceSource
‘‘8 C
source
‘‘D J
,
‘‘J K
string
‘‘L R
name
‘‘S W
)
‘‘W X
{
’’ 
var
÷÷ 
activity
÷÷ 
=
÷÷ 
new
÷÷ "%
PowerShellTraceActivity
÷÷# :
(
÷÷: ;
source
÷÷; A
,
÷÷A B
name
÷÷C G
)
÷÷G H
;
÷÷H I
if
ÿÿ 
(
ÿÿ 
activity
ÿÿ 
.
ÿÿ !
_previousActivityId
ÿÿ 0
!=
ÿÿ1 3
Guid
ÿÿ4 8
.
ÿÿ8 9
Empty
ÿÿ9 >
)
ÿÿ> ?
source
ŸŸ 
.
ŸŸ 
TraceTransfer
ŸŸ (
(
ŸŸ( )
$num
ŸŸ) *
,
ŸŸ* +
null
ŸŸ, 0
,
ŸŸ0 1
activity
ŸŸ2 :
.
ŸŸ: ;
_activityId
ŸŸ; F
)
ŸŸF G
;
ŸŸG H
Trace
€€ 
.
€€  
CorrelationManager
€€ (
.
€€( )

ActivityId
€€) 3
=
€€4 5
activity
€€6 >
.
€€> ?
_activityId
€€? J
;
€€J K
source
›› 
.
›› 

TraceEvent
›› !
(
››! "
TraceEventType
››" 0
.
››0 1
Start
››1 6
,
››6 7
$num
››8 9
,
››9 :
$str
››; E
,
››E F
source
››G M
.
››M N
Name
››N R
,
››R S
activity
››T \
.
››\ ]
_name
››] b
)
››b c
;
››c d
return
ﬂﬂ 
activity
ﬂﬂ 
;
ﬂﬂ  
}
‡‡ 
~
‚‚ %
PowerShellTraceActivity
‚‚ $
(
‚‚$ %
)
‚‚% &
{
„„ 
Dispose
‰‰ 
(
‰‰ 
false
‰‰ 
)
‰‰ 
;
‰‰ 
}
ÂÂ 
void
ÁÁ 
IDisposable
ÁÁ 
.
ÁÁ 
Dispose
ÁÁ $
(
ÁÁ$ %
)
ÁÁ% &
{
ËË 
Dispose
ÈÈ 
(
ÈÈ 
true
ÈÈ 
)
ÈÈ 
;
ÈÈ 
GC
ÍÍ 
.
ÍÍ 
SuppressFinalize
ÍÍ #
(
ÍÍ# $
this
ÍÍ$ (
)
ÍÍ( )
;
ÍÍ) *
}
ÎÎ 
[
ÌÌ 
Conditional
ÌÌ 
(
ÌÌ 
$str
ÌÌ  
)
ÌÌ  !
]
ÌÌ! "
public
ÓÓ 
void
ÓÓ 
Complete
ÓÓ  
(
ÓÓ  !
)
ÓÓ! "
{
ÔÔ 
if
 
(
 
this
 
.
 !
_previousActivityId
 ,
!=
- /
Guid
0 4
.
4 5
Empty
5 :
)
: ;
this
ÒÒ 
.
ÒÒ 
_source
ÒÒ  
.
ÒÒ  !
TraceTransfer
ÒÒ! .
(
ÒÒ. /
$num
ÒÒ/ 0
,
ÒÒ0 1
null
ÒÒ2 6
,
ÒÒ6 7
this
ÒÒ8 <
.
ÒÒ< =!
_previousActivityId
ÒÒ= P
)
ÒÒP Q
;
ÒÒQ R
this
ÛÛ 
.
ÛÛ 
_source
ÛÛ 
.
ÛÛ 

TraceEvent
ÛÛ '
(
ÛÛ' (
TraceEventType
ÛÛ( 6
.
ÛÛ6 7
Stop
ÛÛ7 ;
,
ÛÛ; <
$num
ÛÛ= >
,
ÛÛ> ?
$str
ÛÛ@ ]
,
ÛÛ] ^
this
ÛÛ_ c
.
ÛÛc d
_source
ÛÛd k
.
ÛÛk l
Name
ÛÛl p
,
ÛÛp q
this
ÛÛr v
.
ÛÛv w
_name
ÛÛw |
,
ÛÛ| }
thisÛÛ~ Ç
.ÛÛÇ É
_swÛÛÉ Ü
.ÛÛÜ á#
ElapsedMillisecondsÛÛá ö
)ÛÛö õ
;ÛÛõ ú
Trace
ÙÙ 
.
ÙÙ  
CorrelationManager
ÙÙ (
.
ÙÙ( )

ActivityId
ÙÙ) 3
=
ÙÙ4 5
this
ÙÙ6 :
.
ÙÙ: ;!
_previousActivityId
ÙÙ; N
;
ÙÙN O
}
ıı 
private
˜˜ 
void
˜˜ 
Dispose
˜˜  
(
˜˜  !
bool
˜˜! %
	disposing
˜˜& /
)
˜˜/ 0
{
¯¯ 
if
˘˘ 
(
˘˘ 
	disposing
˘˘ 
)
˘˘ 
{
˙˙ 
if
˚˚ 
(
˚˚ 
this
˚˚ 
.
˚˚ 
_source
˚˚ $
!=
˚˚% '
null
˚˚( ,
)
˚˚, -
{
¸¸ 
this
˝˝ 
.
˝˝ 
Complete
˝˝ %
(
˝˝% &
)
˝˝& '
;
˝˝' (
this
˛˛ 
.
˛˛ 
_source
˛˛ $
=
˛˛% &
null
˛˛' +
;
˛˛+ ,
}
ˇˇ 
}
ÄÄ 
}
ÅÅ 
}
ÇÇ 	
}
ÉÉ 
}ÑÑ ∂Å
;C:\w\MIM-PowerShell\src\MIM.PowerShell\MASynchronization.cs
	namespace

 	
MIM


 
.

 

PowerShell

 
{ 
public 

sealed 
class 
MASynchronization )
:* +
	PSRuntime, 5
,5 6
IMASynchronization7 I
{ 
public 
DeprovisionAction  
Deprovision! ,
(, -
CSEntry- 4
csentry5 <
)< =
{ 	
using 
( 
TraceSource 
. 
TraceMethod *
(* +
)+ ,
), -
{ 
TraceSource 
. 
TraceParameter *
(* +
$str+ 4
,4 5
csentry6 =
)= >
;> ?
var 

scriptPath 
=  
FindMaScript! -
(- .
csentry. 5
.5 6
MA6 8
.8 9
Name9 =
,= >
$str? P
)P Q
;Q R
if 
( 
! 
File 
. 
Exists  
(  !

scriptPath! +
)+ ,
), -
throw -
!EntryPointNotImplementedException ;
(; <
csentry< C
.C D
MAD F
.F G
NameG K
,K L
$strM ^
)^ _
;_ `
	AddScript 
( 

scriptPath $
)$ %
. 
AddParameter !
(! "
$str" +
,+ ,
csentry- 4
)4 5
;5 6
var 
action 
= 
Invoke #
<# $
DeprovisionAction$ 5
>5 6
(6 7
)7 8
.8 9
First9 >
(> ?
)? @
;@ A
TraceSource 
. 
TraceObject '
(' (
action( .
). /
;/ 0
return   
action   
;   
}!! 
}"" 	
public$$ 
bool$$ "
FilterForDisconnection$$ *
($$* +
CSEntry$$+ 2
csentry$$3 :
)$$: ;
{%% 	
using&& 
(&& 
TraceSource&& 
.&& 
TraceMethod&& *
(&&* +
)&&+ ,
)&&, -
{'' 
TraceSource(( 
.(( 
TraceParameter(( *
(((* +
$str((+ 4
,((4 5
csentry((6 =
)((= >
;((> ?
var** 

scriptPath** 
=**  
FindMaScript**! -
(**- .
csentry**. 5
.**5 6
MA**6 8
.**8 9
Name**9 =
,**= >
$str**? [
)**[ \
;**\ ]
if,, 
(,, 
!,, 
File,, 
.,, 
Exists,,  
(,,  !

scriptPath,,! +
),,+ ,
),,, -
throw-- -
!EntryPointNotImplementedException-- ;
(--; <
csentry--< C
.--C D
MA--D F
.--F G
Name--G K
,--K L
$str--M ^
)--^ _
;--_ `
	AddScript// 
(// 

scriptPath// $
)//$ %
.00 
AddParameter00 !
(00! "
$str00" +
,00+ ,
csentry00- 4
)004 5
;005 6
var22 
filtered22 
=22 
Invoke22 %
<22% &
bool22& *
>22* +
(22+ ,
)22, -
.22- .
FirstOrDefault22. <
(22< =
)22= >
;22> ?
TraceSource44 
.44 
TraceObject44 '
(44' (
filtered44( 0
)440 1
;441 2
return66 
filtered66 
;66  
}77 
}88 	
public:: 
void:: "
MapAttributesForExport:: *
(::* +
string::+ 1
flowRuleName::2 >
,::> ?
MVEntry::@ G
mventry::H O
,::O P
CSEntry::Q X
csentry::Y `
)::` a
{;; 	
using<< 
(<< 
TraceSource<< 
.<< 
TraceMethod<< *
(<<* +
)<<+ ,
)<<, -
{== 
TraceSource>> 
.>> 
TraceParameter>> *
(>>* +
$str>>+ 9
,>>9 :
flowRuleName>>; G
)>>G H
;>>H I
TraceSource?? 
.?? 
TraceParameter?? *
(??* +
$str??+ 4
,??4 5
mventry??6 =
)??= >
;??> ?
TraceSource@@ 
.@@ 
TraceParameter@@ *
(@@* +
$str@@+ 4
,@@4 5
csentry@@6 =
)@@= >
;@@> ?
varBB 

scriptPathBB 
=BB  
FindMaScriptBB! -
(BB- .
csentryBB. 5
.BB5 6
MABB6 8
.BB8 9
NameBB9 =
,BB= >
$strBB? [
)BB[ \
;BB\ ]
ifDD 
(DD 
!DD 
FileDD 
.DD 
ExistsDD  
(DD  !

scriptPathDD! +
)DD+ ,
)DD, -
throwEE -
!EntryPointNotImplementedExceptionEE ;
(EE; <
csentryEE< C
.EEC D
MAEED F
.EEF G
NameEEG K
,EEK L
$strEEM i
)EEi j
;EEj k
	AddScriptGG 
(GG 

scriptPathGG $
)GG$ %
.HH 
AddParameterHH !
(HH! "
$strHH" 0
,HH0 1
flowRuleNameHH2 >
)HH> ?
.II 
AddParameterII !
(II! "
$strII" +
,II+ ,
mventryII- 4
)II4 5
.JJ 
AddParameterJJ !
(JJ! "
$strJJ" +
,JJ+ ,
csentryJJ- 4
)JJ4 5
;JJ5 6
InvokeLL 
(LL 
)LL 
;LL 
}MM 
}NN 	
publicPP 
voidPP "
MapAttributesForImportPP *
(PP* +
stringPP+ 1
flowRuleNamePP2 >
,PP> ?
CSEntryPP@ G
csentryPPH O
,PPO P
MVEntryPPQ X
mventryPPY `
)PP` a
{QQ 	
usingRR 
(RR 
TraceSourceRR 
.RR 
TraceMethodRR *
(RR* +
)RR+ ,
)RR, -
{SS 
TraceSourceTT 
.TT 
TraceParameterTT *
(TT* +
$strTT+ 9
,TT9 :
flowRuleNameTT; G
)TTG H
;TTH I
TraceSourceUU 
.UU 
TraceParameterUU *
(UU* +
$strUU+ 4
,UU4 5
mventryUU6 =
)UU= >
;UU> ?
TraceSourceVV 
.VV 
TraceParameterVV *
(VV* +
$strVV+ 4
,VV4 5
csentryVV6 =
)VV= >
;VV> ?
varXX 

scriptPathXX 
=XX  
FindMaScriptXX! -
(XX- .
csentryXX. 5
.XX5 6
MAXX6 8
.XX8 9
NameXX9 =
,XX= >
$strXX? [
)XX[ \
;XX\ ]
ifZZ 
(ZZ 
!ZZ 
FileZZ 
.ZZ 
ExistsZZ  
(ZZ  !

scriptPathZZ! +
)ZZ+ ,
)ZZ, -
throw[[ -
!EntryPointNotImplementedException[[ ;
([[; <
csentry[[< C
.[[C D
MA[[D F
.[[F G
Name[[G K
,[[K L
$str[[M ^
)[[^ _
;[[_ `
	AddScript]] 
(]] 

scriptPath]] $
)]]$ %
.^^ 
AddParameter^^ !
(^^! "
$str^^" 0
,^^0 1
flowRuleName^^2 >
)^^> ?
.__ 
AddParameter__ !
(__! "
$str__" +
,__+ ,
mventry__- 4
)__4 5
.`` 
AddParameter`` !
(``! "
$str``" +
,``+ ,
csentry``- 4
)``4 5
;``5 6
Invokebb 
(bb 
)bb 
;bb 
}cc 
}dd 	
publicff 
voidff  
MapAttributesForJoinff (
(ff( )
stringff) /
flowRuleNameff0 <
,ff< =
CSEntryff> E
csentryffF M
,ffM N
refffO R
ValueCollectionffS b
valuesffc i
)ffi j
{gg 	
usinghh 
(hh 
TraceSourcehh 
.hh 
TraceMethodhh *
(hh* +
)hh+ ,
)hh, -
{ii 
TraceSourcejj 
.jj 
TraceParameterjj *
(jj* +
$strjj+ 9
,jj9 :
flowRuleNamejj; G
)jjG H
;jjH I
TraceSourcekk 
.kk 
TraceParameterkk *
(kk* +
$strkk+ 4
,kk4 5
csentrykk6 =
)kk= >
;kk> ?
TraceSourcell 
.ll 
TraceParameterll *
(ll* +
$strll+ 3
,ll3 4
valuesll5 ;
)ll; <
;ll< =
varnn 

scriptPathnn 
=nn  
FindMaScriptnn! -
(nn- .
csentrynn. 5
.nn5 6
MAnn6 8
.nn8 9
Namenn9 =
,nn= >
$strnn? Y
)nnY Z
;nnZ [
ifpp 
(pp 
!pp 
Filepp 
.pp 
Existspp  
(pp  !

scriptPathpp! +
)pp+ ,
)pp, -
throwqq -
!EntryPointNotImplementedExceptionqq ;
(qq; <
csentryqq< C
.qqC D
MAqqD F
.qqF G
NameqqG K
,qqK L
$strqqM ^
)qq^ _
;qq_ `
	AddScriptss 
(ss 

scriptPathss $
)ss$ %
.tt 
AddParametertt !
(tt! "
$strtt" 0
,tt0 1
flowRuleNamett2 >
)tt> ?
.uu 
AddParameteruu !
(uu! "
$struu" +
,uu+ ,
csentryuu- 4
)uu4 5
.vv 
AddParametervv !
(vv! "
$strvv" *
,vv* +
valuesvv, 2
)vv2 3
;vv3 4
Invokexx 
(xx 
)xx 
;xx 
}yy 
}zz 	
public|| 
bool|| 
ResolveJoinSearch|| %
(||% &
string||& ,
joinCriteriaName||- =
,||= >
CSEntry||? F
csentry||G N
,||N O
MVEntry||P W
[||W X
]||X Y
	rgmventry||Z c
,||c d
out||e h
int||i l
imventry||m u
,||u v
ref||w z
string	||{ Å
MVObjectType
||Ç é
)
||é è
{}} 	
using~~ 
(~~ 
TraceSource~~ 
.~~ 
TraceMethod~~ *
(~~* +
)~~+ ,
)~~, -
{ 
TraceSource
ÄÄ 
.
ÄÄ 
TraceParameter
ÄÄ *
(
ÄÄ* +
$str
ÄÄ+ =
,
ÄÄ= >
joinCriteriaName
ÄÄ? O
)
ÄÄO P
;
ÄÄP Q
TraceSource
ÅÅ 
.
ÅÅ 
TraceParameter
ÅÅ *
(
ÅÅ* +
$str
ÅÅ+ 4
,
ÅÅ4 5
csentry
ÅÅ6 =
)
ÅÅ= >
;
ÅÅ> ?
TraceSource
ÇÇ 
.
ÇÇ 
TraceParameter
ÇÇ *
(
ÇÇ* +
$str
ÇÇ+ 6
,
ÇÇ6 7
	rgmventry
ÇÇ8 A
)
ÇÇA B
;
ÇÇB C
var
ÑÑ 

scriptPath
ÑÑ 
=
ÑÑ  
FindMaScript
ÑÑ! -
(
ÑÑ- .
csentry
ÑÑ. 5
.
ÑÑ5 6
MA
ÑÑ6 8
.
ÑÑ8 9
Name
ÑÑ9 =
,
ÑÑ= >
$str
ÑÑ? V
)
ÑÑV W
;
ÑÑW X
if
ÜÜ 
(
ÜÜ 
!
ÜÜ 
File
ÜÜ 
.
ÜÜ 
Exists
ÜÜ  
(
ÜÜ  !

scriptPath
ÜÜ! +
)
ÜÜ+ ,
)
ÜÜ, -
throw
áá /
!EntryPointNotImplementedException
áá ;
(
áá; <
csentry
áá< C
.
ááC D
MA
ááD F
.
ááF G
Name
ááG K
,
ááK L
$str
ááM ^
)
áá^ _
;
áá_ `
	AddScript
ââ 
(
ââ 

scriptPath
ââ $
)
ââ$ %
.
ää 
AddParameter
ää !
(
ää! "
$str
ää" 4
,
ää4 5
joinCriteriaName
ää6 F
)
ääF G
.
ãã 
AddParameter
ãã !
(
ãã! "
$str
ãã" +
,
ãã+ ,
csentry
ãã- 4
)
ãã4 5
.
åå 
AddParameter
åå !
(
åå! "
$str
åå" -
,
åå- .
	rgmventry
åå/ 8
)
åå8 9
.
çç 
AddParameter
çç !
(
çç! "
$str
çç" 0
,
çç0 1
MVObjectType
çç2 >
)
çç> ?
;
çç? @
imventry
èè 
=
èè 
Invoke
èè !
<
èè! "
int
èè" %
>
èè% &
(
èè& '
)
èè' (
.
èè( )
First
èè) .
(
èè. /
)
èè/ 0
;
èè0 1
TraceSource
ëë 
.
ëë 
TraceObject
ëë '
(
ëë' (
imventry
ëë( 0
)
ëë0 1
;
ëë1 2
return
ìì 
imventry
ìì 
>=
ìì  "
$num
ìì# $
;
ìì$ %
}
îî 
}
ïï 	
public
óó 
bool
óó 
ShouldProjectToMV
óó %
(
óó% &
CSEntry
óó& -
csentry
óó. 5
,
óó5 6
out
óó7 :
string
óó; A
MVObjectType
óóB N
)
óóN O
{
òò 	
using
ôô 
(
ôô 
TraceSource
ôô 
.
ôô 
TraceMethod
ôô *
(
ôô* +
)
ôô+ ,
)
ôô, -
{
öö 
TraceSource
õõ 
.
õõ 
TraceParameter
õõ *
(
õõ* +
$str
õõ+ 4
,
õõ4 5
csentry
õõ6 =
)
õõ= >
;
õõ> ?
var
ùù 

scriptPath
ùù 
=
ùù  
FindMaScript
ùù! -
(
ùù- .
csentry
ùù. 5
.
ùù5 6
MA
ùù6 8
.
ùù8 9
Name
ùù9 =
,
ùù= >
$str
ùù? V
)
ùùV W
;
ùùW X
if
üü 
(
üü 
!
üü 
File
üü 
.
üü 
Exists
üü  
(
üü  !

scriptPath
üü! +
)
üü+ ,
)
üü, -
throw
†† /
!EntryPointNotImplementedException
†† ;
(
††; <
csentry
††< C
.
††C D
MA
††D F
.
††F G
Name
††G K
,
††K L
$str
††M ^
)
††^ _
;
††_ `
	AddScript
¢¢ 
(
¢¢ 

scriptPath
¢¢ $
)
¢¢$ %
.
££ 
AddParameter
££ !
(
££! "
$str
££" +
,
££+ ,
csentry
££- 4
)
££4 5
;
££5 6
MVObjectType
•• 
=
•• 
Invoke
•• %
<
••% &
string
••& ,
>
••, -
(
••- .
)
••. /
.
••/ 0
Where
••0 5
(
••5 6
s
••6 7
=>
••8 :
!
••; <
string
••< B
.
••B C 
IsNullOrWhiteSpace
••C U
(
••U V
s
••V W
)
••W X
)
••X Y
.
••Y Z
FirstOrDefault
••Z h
(
••h i
)
••i j
;
••j k
TraceSource
ßß 
.
ßß 
TraceObject
ßß '
(
ßß' (
MVObjectType
ßß( 4
)
ßß4 5
;
ßß5 6
return
©© 
!
©© 
string
©© 
.
©©  
IsNullOrWhiteSpace
©© 1
(
©©1 2
MVObjectType
©©2 >
)
©©> ?
;
©©? @
}
™™ 
}
´´ 	
void
≠≠  
IMASynchronization
≠≠ 
.
≠≠  

Initialize
≠≠  *
(
≠≠* +
)
≠≠+ ,
{
ÆÆ 	
base
ØØ 
.
ØØ 

Initialize
ØØ 
(
ØØ 
)
ØØ 
;
ØØ 
}
∞∞ 	
void
≤≤  
IMASynchronization
≤≤ 
.
≤≤  
	Terminate
≤≤  )
(
≤≤) *
)
≤≤* +
{
≥≥ 	
base
¥¥ 
.
¥¥ 
Dispose
¥¥ 
(
¥¥ 
)
¥¥ 
;
¥¥ 
}
µµ 	
}
∂∂ 
}∑∑ ã"
;C:\w\MIM-PowerShell\src\MIM.PowerShell\MVSynchronization.cs
	namespace

 	
MIM


 
.

 

PowerShell

 
{ 
public 

sealed 
class 
MVSynchronization )
:* +
	PSRuntime, 5
,5 6
IMVSynchronization7 I
{ 
public 
void 
	Provision 
( 
MVEntry %
mventry& -
)- .
{ 	
using 
( 
TraceSource 
. 
TraceMethod *
(* +
)+ ,
), -
{ 
TraceSource 
. 
TraceParameter *
(* +
$str+ 4
,4 5
mventry6 =
)= >
;> ?
foreach 
( 
var 
maName #
in$ &
Utils' ,
., -
MAs- 0
)0 1
{ 
var 

scriptPath "
=# $
FindMaScript% 1
(1 2
maName2 8
,8 9
$str: I
)I J
;J K
if 
( 
File 
. 
Exists #
(# $

scriptPath$ .
). /
)/ 0
{ 
	AddScript !
(! "

scriptPath" ,
), -
. 
AddParameter )
() *
$str* 3
,3 4
mventry5 <
)< =
;= >
Invoke 
( 
)  
;  !
} 
} 
}   
}!! 	
public## 
bool## 
ShouldDeleteFromMV## &
(##& '
CSEntry##' .
csentry##/ 6
,##6 7
MVEntry##8 ?
mventry##@ G
)##G H
{$$ 	
using%% 
(%% 
TraceSource%% 
.%% 
TraceMethod%% *
(%%* +
)%%+ ,
)%%, -
{&& 
TraceSource'' 
.'' 
TraceParameter'' *
(''* +
$str''+ 4
,''4 5
csentry''6 =
)''= >
;''> ?
TraceSource(( 
.(( 
TraceParameter(( *
(((* +
$str((+ 4
,((4 5
mventry((6 =
)((= >
;((> ?
var** 

scriptPath** 
=**  
FindMaScript**! -
(**- .
csentry**. 5
.**5 6
MA**6 8
.**8 9
Name**9 =
,**= >
$str**? W
)**W X
;**X Y
if,, 
(,, 
!,, 
File,, 
.,, 
Exists,,  
(,,  !

scriptPath,,! +
),,+ ,
),,, -
throw-- -
!EntryPointNotImplementedException-- ;
(--; <
csentry--< C
.--C D
MA--D F
.--F G
Name--G K
,--K L
$str--M e
)--e f
;--f g
	AddScript// 
(// 

scriptPath// $
)//$ %
.00 
AddParameter00 !
(00! "
$str00" +
,00+ ,
csentry00- 4
)004 5
.11 
AddParameter11 !
(11! "
$str11" +
,11+ ,
mventry11- 4
)114 5
;115 6
var33 
shouldDelete33  
=33! "
Invoke33# )
<33) *
bool33* .
>33. /
(33/ 0
)330 1
.331 2
FirstOrDefault332 @
(33@ A
)33A B
;33B C
TraceSource55 
.55 
TraceObject55 '
(55' (
shouldDelete55( 4
)554 5
;555 6
return77 
shouldDelete77 #
;77# $
}88 
}99 	
void;; 
IMVSynchronization;; 
.;;  

Initialize;;  *
(;;* +
);;+ ,
{<< 	
base== 
.== 

Initialize== 
(== 
)== 
;== 
}>> 	
void@@ 
IMVSynchronization@@ 
.@@  
	Terminate@@  )
(@@) *
)@@* +
{AA 	
baseBB 
.BB 
DisposeBB 
(BB 
)BB 
;BB 
}CC 	
}DD 
}EE °ö
3C:\w\MIM-PowerShell\src\MIM.PowerShell\PSRuntime.cs
	namespace 	
MIM
 
. 

PowerShell 
{ 
public 

abstract 
class 
	PSRuntime #
:$ %
IDisposable& 1
{ 
Runspace 
	_runspace 
; 
	PSCommand 
	_commands 
; 
	protected 
	PSRuntime 
( 
) 
{ 	
TraceSource 
= 
new 
PSTraceSource +
(+ ,
this, 0
.0 1
GetType1 8
(8 9
)9 :
.: ;
FullName; C
)C D
;D E
} 	
~ 	
	PSRuntime	 
( 
) 
{ 	
Dispose 
( 
false 
) 
; 
} 	
	protected 
PSTraceSource 
TraceSource  +
{   	
get!! 
;!! 
private"" 
set"" 
;"" 
}## 	
	protected%% 
void%% 

Initialize%% !
(%%! "
)%%" #
{&& 	
try'' 
{(( 
using)) 
()) 
TraceSource)) "
.))" #
TraceMethod))# .
()). /
)))/ 0
)))0 1
{** 
this-- 
.-- 
	_runspace-- "
=--# $
RunspaceFactory--% 4
.--4 5
CreateRunspace--5 C
(--C D
)--D E
;--E F
this.. 
... 
	_runspace.. "
..." #
ThreadOptions..# 0
=..1 2
PSThreadOptions..3 B
...B C
UseCurrentThread..C S
;..S T
this00 
.00 
	_runspace00 "
.00" #
Open00# '
(00' (
)00( )
;00) *
foreach44 
(44 
var44  
path44! %
in44& (
Profile44) 0
)440 1
{55 
if66 
(66 
File66  
.66  !
Exists66! '
(66' (
path66( ,
)66, -
)66- .
{77 
	AddScript88 %
(88% &
path88& *
)88* +
;88+ ,
Invoke99 "
(99" #
)99# $
;99$ %
}:: 
};; 
}<< 
}== 
catch>> 
(>> 
	Exception>> 
ex>> 
)>>  
{?? 
TraceSource@@ 
.@@ 
TraceException@@ *
(@@* +
TraceEventType@@+ 9
.@@9 :
Critical@@: B
,@@B C
ex@@D F
,@@F G
$str@@H r
,@@r s
ex@@t v
.@@v w
Message@@w ~
)@@~ 
;	@@ Ä
throwAA 
;AA 
}BB 
}CC 	
publicEE 
voidEE 
DisposeEE 
(EE 
)EE 
{FF 	
DisposeGG 
(GG 
trueGG 
)GG 
;GG 
GCHH 
.HH 
SuppressFinalizeHH 
(HH  
thisHH  $
)HH$ %
;HH% &
}II 	
	protectedKK 
virtualKK 
voidKK 
DisposeKK &
(KK& '
boolKK' +
	disposingKK, 5
)KK5 6
{LL 	
ifMM 
(MM 
	disposingMM 
)MM 
{NN 
usingOO 
(OO 
TraceSourceOO "
.OO" #
TraceMethodOO# .
(OO. /
)OO/ 0
)OO0 1
{PP 
ifQQ 
(QQ 
thisQQ 
.QQ 
	_runspaceQQ &
!=QQ' )
nullQQ* .
)QQ. /
thisRR 
.RR 
	_runspaceRR &
.RR& '
DisposeRR' .
(RR. /
)RR/ 0
;RR0 1
}SS 
}TT 
}UU 	
	protectedWW 
	PSCommandWW 
	AddScriptWW %
(WW% &
stringWW& ,
pathWW- 1
,WW1 2
boolWW3 7
useLocalScopeWW8 E
=WWF G
falseWWH M
)WWM N
{XX 	
usingYY 
(YY 
TraceSourceYY 
.YY 
TraceMethodYY *
(YY* +
)YY+ ,
)YY, -
{ZZ 
TraceSource[[ 
.[[ 
TraceParameter[[ *
([[* +
$str[[+ 1
,[[1 2
path[[3 7
)[[7 8
;[[8 9
TraceSource\\ 
.\\ 
TraceParameter\\ *
(\\* +
$str\\+ :
,\\: ;
useLocalScope\\< I
)\\I J
;\\J K
if^^ 
(^^ 
!^^ 
File^^ 
.^^ 
Exists^^  
(^^  !
path^^! %
)^^% &
)^^& '
throw__ 
new__ !
FileNotFoundException__ 3
(__3 4
$str__4 _
,___ `
path__a e
)__e f
;__f g
varaa 
scriptaa 
=aa 
ReadAllTextaa (
(aa( )
pathaa) -
)aa- .
;aa. /
TraceSourcecc 
.cc 
TraceVerbosecc (
(cc( )
scriptcc) /
)cc/ 0
;cc0 1
ifee 
(ee 
thisee 
.ee 
	_commandsee "
==ee# %
nullee& *
)ee* +
thisff 
.ff 
	_commandsff "
=ff# $
newff% (
	PSCommandff) 2
(ff2 3
)ff3 4
;ff4 5
thishh 
.hh 
	_commandshh 
.hh 
	AddScripthh (
(hh( )
scripthh) /
,hh/ 0
useLocalScopehh1 >
)hh> ?
;hh? @
returnjj 
thisjj 
.jj 
	_commandsjj %
;jj% &
}kk 
}ll 	
	protectednn 
stringnn 
FindMaScriptnn %
(nn% &
stringnn& ,
maNamenn- 3
,nn3 4
stringnn5 ;
namenn< @
)nn@ A
{oo 	
usingpp 
(pp 
TraceSourcepp 
.pp 
TraceMethodpp *
(pp* +
)pp+ ,
)pp, -
{qq 
TraceSourcerr 
.rr 
TraceParameterrr *
(rr* +
$strrr+ 3
,rr3 4
maNamerr5 ;
)rr; <
;rr< =
TraceSourcess 
.ss 
TraceParameterss *
(ss* +
$strss+ 1
,ss1 2
namess3 7
)ss7 8
;ss8 9
ifuu 
(uu 
stringuu 
.uu 
IsNullOrWhiteSpaceuu -
(uu- .
MADatauu. 4
)uu4 5
)uu5 6
returnvv 
nullvv 
;vv  
varxx 
pathxx 
=xx 

FindScriptxx %
(xx% &
Pathxx& *
.xx* +
Combinexx+ 2
(xx2 3
MADataxx3 9
,xx9 :
maNamexx; A
)xxA B
,xxB C
namexxD H
)xxH I
;xxI J
TraceSourceyy 
.yy 
TraceObjectyy '
(yy' (
pathyy( ,
)yy, -
;yy- .
returnzz 
pathzz 
;zz 
}{{ 
}|| 	
string~~ 

FindScript~~ 
(~~ 
string~~  
path~~! %
,~~% &
string~~' -
fileName~~. 6
)~~6 7
{ 	
using
ÄÄ 
(
ÄÄ 
TraceSource
ÄÄ 
.
ÄÄ 
TraceMethod
ÄÄ *
(
ÄÄ* +
)
ÄÄ+ ,
)
ÄÄ, -
{
ÅÅ 
TraceSource
ÇÇ 
.
ÇÇ 
TraceParameter
ÇÇ *
(
ÇÇ* +
$str
ÇÇ+ 1
,
ÇÇ1 2
path
ÇÇ3 7
)
ÇÇ7 8
;
ÇÇ8 9
TraceSource
ÉÉ 
.
ÉÉ 
TraceParameter
ÉÉ *
(
ÉÉ* +
$str
ÉÉ+ 5
,
ÉÉ5 6
fileName
ÉÉ7 ?
)
ÉÉ? @
;
ÉÉ@ A
var
ÖÖ 

scriptPath
ÖÖ 
=
ÖÖ  
	Directory
ÖÖ! *
.
ÖÖ* +
GetFiles
ÖÖ+ 3
(
ÖÖ3 4
path
ÖÖ4 8
,
ÖÖ8 9
fileName
ÖÖ: B
,
ÖÖB C
SearchOption
ÖÖD P
.
ÖÖP Q
AllDirectories
ÖÖQ _
)
ÖÖ_ `
.
ÖÖ` a
FirstOrDefault
ÖÖa o
(
ÖÖo p
)
ÖÖp q
;
ÖÖq r
TraceSource
ÜÜ 
.
ÜÜ 
TraceVerbose
ÜÜ (
(
ÜÜ( )

scriptPath
ÜÜ) 3
)
ÜÜ3 4
;
ÜÜ4 5
return
áá 

scriptPath
áá !
;
áá! "
}
àà 
}
ââ 	
	protected
ãã 
string
ãã 
MAFolder
ãã !
{
åå 	
get
çç 
{
éé 
try
èè 
{
êê 
return
ëë 
MAUtils
ëë "
.
ëë" #
MAFolder
ëë# +
;
ëë+ ,
}
íí 
catch
ìì 
{
îî 
return
ïï 
null
ïï 
;
ïï  
}
ññ 
}
óó 
}
òò 	
	protected
öö 
string
öö !
ExtensionsDirectory
öö ,
{
õõ 	
get
úú 
{
ùù 
try
ûû 
{
üü 
return
†† 
Utils
††  
.
††  !!
ExtensionsDirectory
††! 4
;
††4 5
}
°° 
catch
¢¢ 
{
££ 
return
§§ 
null
§§ 
;
§§  
}
•• 
}
¶¶ 
}
ßß 	
	protected
©© 
string
©© 
MAData
©© 
{
™™ 	
get
´´ 
{
¨¨ 
try
≠≠ 
{
ÆÆ 
return
ØØ 
Path
ØØ 
.
ØØ  
GetFullPath
ØØ  +
(
ØØ+ ,
Path
ØØ, 0
.
ØØ0 1
Combine
ØØ1 8
(
ØØ8 9
Utils
ØØ9 >
.
ØØ> ?!
ExtensionsDirectory
ØØ? R
,
ØØR S
$str
ØØT `
)
ØØ` a
)
ØØa b
;
ØØb c
}
∞∞ 
catch
±± 
{
≤≤ 
return
≥≥ 
null
≥≥ 
;
≥≥  
}
¥¥ 
}
µµ 
}
∂∂ 	
IEnumerable
∏∏ 
<
∏∏ 
string
∏∏ 
>
∏∏ 
Profile
∏∏ #
{
ππ 	
get
∫∫ 
{
ªª 
yield
ºº 
return
ºº 
Path
ºº !
.
ºº! "
GetFullPath
ºº" -
(
ºº- .
Path
ºº. 2
.
ºº2 3
Combine
ºº3 :
(
ºº: ;
Environment
ºº; F
.
ººF G(
ExpandEnvironmentVariables
ººG a
(
ººa b
$strººb ë
)ººë í
,ººí ì
$strººî ®
)ºº® ©
)ºº© ™
;ºº™ ´
if
ææ 
(
ææ 
!
ææ 
string
ææ 
.
ææ  
IsNullOrWhiteSpace
ææ .
(
ææ. /!
ExtensionsDirectory
ææ/ B
)
ææB C
)
ææC D
yield
øø 
return
øø  
Path
øø! %
.
øø% &
GetFullPath
øø& 1
(
øø1 2
Path
øø2 6
.
øø6 7
Combine
øø7 >
(
øø> ?!
ExtensionsDirectory
øø? R
,
øøR S
$str
øøT h
)
øøh i
)
øøi j
;
øøj k
if
¡¡ 
(
¡¡ 
!
¡¡ 
string
¡¡ 
.
¡¡  
IsNullOrWhiteSpace
¡¡ .
(
¡¡. /
MAFolder
¡¡/ 7
)
¡¡7 8
)
¡¡8 9
yield
¬¬ 
return
¬¬  
Path
¬¬! %
.
¬¬% &
GetFullPath
¬¬& 1
(
¬¬1 2
Path
¬¬2 6
.
¬¬6 7
Combine
¬¬7 >
(
¬¬> ?
MAFolder
¬¬? G
,
¬¬G H
$str
¬¬I ]
)
¬¬] ^
)
¬¬^ _
;
¬¬_ `
}
√√ 
}
ƒƒ 	
static
∆∆ 
string
∆∆ 
ReadAllText
∆∆ !
(
∆∆! "
string
∆∆" (
path
∆∆) -
)
∆∆- .
{
«« 	
using
»» 
(
»» 
var
»» 
stream
»» 
=
»» 
File
»»  $
.
»»$ %
Open
»»% )
(
»») *
path
»»* .
,
»». /
FileMode
»»0 8
.
»»8 9
Open
»»9 =
,
»»= >

FileAccess
»»? I
.
»»I J
Read
»»J N
,
»»N O
	FileShare
»»P Y
.
»»Y Z
	ReadWrite
»»Z c
)
»»c d
)
»»d e
using
…… 
(
…… 
var
…… 
reader
…… 
=
…… 
new
……  #
StreamReader
……$ 0
(
……0 1
stream
……1 7
)
……7 8
)
……8 9
return
   
reader
   
.
   
	ReadToEnd
   '
(
  ' (
)
  ( )
;
  ) *
}
ÀÀ 	
	protected
ÕÕ 

Collection
ÕÕ 
<
ÕÕ 
PSObject
ÕÕ %
>
ÕÕ% &
Invoke
ÕÕ' -
(
ÕÕ- .
)
ÕÕ. /
{
ŒŒ 	
using
œœ 
(
œœ 
TraceSource
œœ 
.
œœ 
TraceMethod
œœ *
(
œœ* +
)
œœ+ ,
)
œœ, -
{
–– 
return
—— 
Invoke
—— 
(
—— 
runtime
—— %
=>
——& (
runtime
——) 0
.
——0 1
Invoke
——1 7
(
——7 8
)
——8 9
)
——9 :
;
——: ;
}
““ 
}
”” 	
	protected
’’ 

Collection
’’ 
<
’’ 
T
’’ 
>
’’ 
Invoke
’’  &
<
’’& '
T
’’' (
>
’’( )
(
’’) *
)
’’* +
{
÷÷ 	
using
◊◊ 
(
◊◊ 
TraceSource
◊◊ 
.
◊◊ 
TraceMethod
◊◊ *
(
◊◊* +
)
◊◊+ ,
)
◊◊, -
{
ÿÿ 
return
ŸŸ 
Invoke
ŸŸ 
<
ŸŸ 
T
ŸŸ 
>
ŸŸ  
(
ŸŸ  !
runtime
ŸŸ! (
=>
ŸŸ) +
runtime
ŸŸ, 3
.
ŸŸ3 4
Invoke
ŸŸ4 :
<
ŸŸ: ;
T
ŸŸ; <
>
ŸŸ< =
(
ŸŸ= >
)
ŸŸ> ?
)
ŸŸ? @
;
ŸŸ@ A
}
⁄⁄ 
}
€€ 	
	protected
›› 

Collection
›› 
<
›› 
T
›› 
>
›› 
Invoke
››  &
<
››& '
T
››' (
>
››( )
(
››) *
params
››* 0
object
››1 7
[
››7 8
]
››8 9
input
››: ?
)
››? @
{
ﬁﬁ 	
using
ﬂﬂ 
(
ﬂﬂ 
TraceSource
ﬂﬂ 
.
ﬂﬂ 
TraceMethod
ﬂﬂ *
(
ﬂﬂ* +
)
ﬂﬂ+ ,
)
ﬂﬂ, -
{
‡‡ 
TraceSource
·· 
.
·· 
TraceParameter
·· *
(
··* +
$str
··+ 2
,
··2 3
input
··4 9
)
··9 :
;
··: ;
return
„„ 
Invoke
„„ 
<
„„ 
T
„„ 
>
„„  
(
„„  !
runtime
„„! (
=>
„„) +
runtime
„„, 3
.
„„3 4
Invoke
„„4 :
<
„„: ;
T
„„; <
>
„„< =
(
„„= >
input
„„> C
)
„„C D
)
„„D E
;
„„E F
}
‰‰ 
}
ÂÂ 	

Collection
ÁÁ 
<
ÁÁ 
T
ÁÁ 
>
ÁÁ 
Invoke
ÁÁ 
<
ÁÁ 
T
ÁÁ 
>
ÁÁ 
(
ÁÁ  
Func
ÁÁ  $
<
ÁÁ$ %
System
ÁÁ% +
.
ÁÁ+ ,

Management
ÁÁ, 6
.
ÁÁ6 7

Automation
ÁÁ7 A
.
ÁÁA B

PowerShell
ÁÁB L
,
ÁÁL M

Collection
ÁÁN X
<
ÁÁX Y
T
ÁÁY Z
>
ÁÁZ [
>
ÁÁ[ \
invoker
ÁÁ] d
)
ÁÁd e
{
ËË 	
try
ÈÈ 
{
ÍÍ 
return
ÎÎ 
Invoke
ÎÎ 
(
ÎÎ 
this
ÎÎ "
.
ÎÎ" #
	_commands
ÎÎ# ,
,
ÎÎ, -
invoker
ÎÎ. 5
)
ÎÎ5 6
;
ÎÎ6 7
}
ÏÏ 
finally
ÌÌ 
{
ÓÓ 
this
ÔÔ 
.
ÔÔ 
	_commands
ÔÔ 
=
ÔÔ  
null
ÔÔ! %
;
ÔÔ% &
}
 
}
ÒÒ 	

Collection
ÛÛ 
<
ÛÛ 
T
ÛÛ 
>
ÛÛ 
Invoke
ÛÛ 
<
ÛÛ 
T
ÛÛ 
>
ÛÛ 
(
ÛÛ  
	PSCommand
ÛÛ  )
commands
ÛÛ* 2
,
ÛÛ2 3
Func
ÛÛ4 8
<
ÛÛ8 9
System
ÛÛ9 ?
.
ÛÛ? @

Management
ÛÛ@ J
.
ÛÛJ K

Automation
ÛÛK U
.
ÛÛU V

PowerShell
ÛÛV `
,
ÛÛ` a

Collection
ÛÛb l
<
ÛÛl m
T
ÛÛm n
>
ÛÛn o
>
ÛÛo p
invoker
ÛÛq x
)
ÛÛx y
{
ÙÙ 	
try
ıı 
{
ˆˆ 
using
˜˜ 
(
˜˜ 
TraceSource
˜˜ "
.
˜˜" #
TraceMethod
˜˜# .
(
˜˜. /
)
˜˜/ 0
)
˜˜0 1
{
¯¯ 
TraceSource
˘˘ 
.
˘˘  
TraceParameter
˘˘  .
(
˘˘. /
$str
˘˘/ 9
,
˘˘9 :
commands
˘˘; C
)
˘˘C D
;
˘˘D E
TraceSource
˙˙ 
.
˙˙  
TraceParameter
˙˙  .
(
˙˙. /
$str
˙˙/ 8
,
˙˙8 9
invoker
˙˙: A
)
˙˙A B
;
˙˙B C
using
¸¸ 
(
¸¸ 
var
¸¸ 
runtime
¸¸ &
=
¸¸' (
System
¸¸) /
.
¸¸/ 0

Management
¸¸0 :
.
¸¸: ;

Automation
¸¸; E
.
¸¸E F

PowerShell
¸¸F P
.
¸¸P Q
Create
¸¸Q W
(
¸¸W X
)
¸¸X Y
)
¸¸Y Z
{
˝˝ 
runtime
˛˛ 
.
˛˛  
Runspace
˛˛  (
=
˛˛) *
this
˛˛+ /
.
˛˛/ 0
	_runspace
˛˛0 9
;
˛˛9 :
runtime
ˇˇ 
.
ˇˇ  
Commands
ˇˇ  (
=
ˇˇ) *
commands
ˇˇ+ 3
;
ˇˇ3 4
return
ÄÄ 
invoker
ÄÄ &
(
ÄÄ& '
runtime
ÄÄ' .
)
ÄÄ. /
;
ÄÄ/ 0
}
ÅÅ 
}
ÇÇ 
}
ÉÉ 
catch
ÑÑ 
(
ÑÑ 
	Exception
ÑÑ 
ex
ÑÑ 
)
ÑÑ  
{
ÖÖ 
TraceSource
ÜÜ 
.
ÜÜ 
TraceException
ÜÜ *
(
ÜÜ* +
TraceEventType
ÜÜ+ 9
.
ÜÜ9 :
Critical
ÜÜ: B
,
ÜÜB C
ex
ÜÜD F
,
ÜÜF G
$str
ÜÜH n
,
ÜÜn o
ex
ÜÜp r
.
ÜÜr s
Message
ÜÜs z
)
ÜÜz {
;
ÜÜ{ |
throw
áá 
;
áá 
}
àà 
}
ââ 	
	protected
ãã /
!EntryPointNotImplementedException
ãã 3/
!EntryPointNotImplementedException
ãã4 U
(
ããU V
string
ããV \
maName
ãã] c
,
ããc d
string
ããe k

scriptName
ããl v
)
ããv w
{
åå 	
return
çç 
new
çç /
!EntryPointNotImplementedException
çç 8
(
çç8 9
string
çç9 ?
.
çç? @
Format
çç@ F
(
ççF G
Thread
ççG M
.
ççM N
CurrentThread
ççN [
.
çç[ \
CurrentCulture
çç\ j
,
ççj k
$strççl ∞
,çç∞ ±
maNameçç≤ ∏
,çç∏ π

scriptNameçç∫ ƒ
)ççƒ ≈
)çç≈ ∆
;çç∆ «
}
éé 	
}
èè 
}êê Ï
AC:\w\MIM-PowerShell\src\MIM.PowerShell\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str )
)) *
]* +
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str I
)I J
]J K
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str +
)+ ,
], -
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str a
)a b
]b c
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *